<!DOCTYPE html>
<html>
<head>
    <title>Mobile Exercise Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial; padding: 20px; }
        .test { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .pass { background: #d4edda; }
        .fail { background: #f8d7da; }
        textarea { width: 100%; min-height: 100px; padding: 10px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üß™ Mobile Exercise Validation Test</h1>
    <p>This page tests if exercise checking works correctly on mobile browsers.</p>
    
    <div class="test">
        <h3>Exercise 1: My First Variable</h3>
        <textarea id="test1">name = "Alice"</textarea>
        <button onclick="testExercise(1)">Test Exercise 1</button>
        <div id="result1"></div>
    </div>
    
    <div class="test">
        <h3>Exercise 2: Age Variable</h3>
        <textarea id="test2">age = 7</textarea>
        <button onclick="testExercise(2)">Test Exercise 2</button>
        <div id="result2"></div>
    </div>
    
    <div class="test">
        <h3>Exercise 3: Favorite Color</h3>
        <textarea id="test3">color = "blue"</textarea>
        <button onclick="testExercise(3)">Test Exercise 3</button>
        <div id="result3"></div>
    </div>
    
    <div class="test">
        <h3>Exercise 11: My First String</h3>
        <textarea id="test11">"Hello"</textarea>
        <button onclick="testExercise(11)">Test Exercise 11</button>
        <div id="result11"></div>
    </div>
    
    <div class="test">
        <h3>Exercise 16: My First List</h3>
        <textarea id="test16">colors = ["red", "blue", "green"]</textarea>
        <button onclick="testExercise(16)">Test Exercise 16</button>
        <div id="result16"></div>
    </div>
    
    <script>
        // Simulate the normalization function
        function normalizeCode(userCode) {
            if (!userCode || typeof userCode !== 'string') {
                return '';
            }
            
            // STEP 1: Clean up mobile keyboard quirks
            let cleanedCode = userCode
                .replace(/\r\n/g, '\n')
                .replace(/\r/g, '\n')
                .replace(/[\u200B-\u200D\uFEFF\u00A0]/g, '')
                .replace(/[\u00A0\u1680\u2000-\u200A\u202F\u205F\u3000]/g, ' ');
            
            // STEP 2: Normalize whitespace
            cleanedCode = cleanedCode.replace(/[ \t]+/g, ' ');
            cleanedCode = cleanedCode.replace(/\n+/g, ' ');
            cleanedCode = cleanedCode.replace(/\s+/g, ' ').trim();
            
            // STEP 3: Make case-insensitive
            return cleanedCode.toLowerCase();
        }
        
        // Exercise checking patterns
        function checkExercise(exerciseId, normalizedCode) {
            console.log('Checking exercise', exerciseId, 'with code:', normalizedCode);
            
            switch(exerciseId) {
                case 1:
                    return /\w+\s*=\s*"[^"]*"/.test(normalizedCode) || /\w+\s*=\s*'[^']*'/.test(normalizedCode);
                case 2:
                    return /\w+\s*=\s*\d+/.test(normalizedCode);
                case 3:
                    return /\w+\s*=\s*"[^"]*"/.test(normalizedCode) || /\w+\s*=\s*'[^']*'/.test(normalizedCode);
                case 11:
                    return /"[^"]*"/.test(normalizedCode) || /'[^']*'/.test(normalizedCode);
                case 16:
                    return /\[.*\]/.test(normalizedCode);
                default:
                    return false;
            }
        }
        
        function testExercise(exerciseId) {
            const inputId = 'test' + exerciseId;
            const resultId = 'result' + exerciseId;
            const textarea = document.getElementById(inputId);
            const resultDiv = document.getElementById(resultId);
            
            const originalCode = textarea.value;
            const normalizedCode = normalizeCode(originalCode);
            const isCorrect = checkExercise(exerciseId, normalizedCode);
            
            console.log('Test Results:', {
                exerciseId,
                original: originalCode,
                normalized: normalizedCode,
                isCorrect
            });
            
            resultDiv.innerHTML = `
                <p><strong>Original:</strong> "${originalCode}"</p>
                <p><strong>Normalized:</strong> "${normalizedCode}"</p>
                <p><strong>Result:</strong> <span style="color:${isCorrect?'green':'red'};font-weight:bold;">${isCorrect ? '‚úÖ PASS' : '‚ùå FAIL'}</span></p>
            `;
            resultDiv.className = isCorrect ? 'pass' : 'fail';
        }
        
        // Auto-run all tests on load
        window.addEventListener('load', function() {
            console.log('Running auto-tests...');
            for (let i = 1; i <= 3; i++) {
                testExercise(i);
            }
            testExercise(11);
            testExercise(16);
        });
    </script>
    <hr>
    <div class="test">
        <h2>üì± Full Mobile Validation Runner (Exercises 1‚Äì50)</h2>
        <p>Runs representative valid answers per exercise through the mobile-normalized checker.</p>
        <button id="runAll">Run All Mobile Checks</button>
        <div id="summary" style="margin:10px 0;font-weight:bold;"></div>
        <div id="results"></div>
    </div>

    <script>
        function mobileNormalize(userCode) {
            if (!userCode || typeof userCode !== 'string') return '';
            let cleanedCode = userCode
                .replace(/\r\n/g, '\n')
                .replace(/\r/g, '\n')
                .replace(/[\u200B-\u200D\uFEFF\u00A0]/g, '')
                .replace(/[\u00A0\u1680\u2000-\u200A\u202F\u205F\u3000]/g, ' ');
            cleanedCode = cleanedCode.replace(/[ \t]+/g, ' ');
            cleanedCode = cleanedCode.replace(/\n+/g, ' ');
            cleanedCode = cleanedCode.replace(/\s+/g, ' ').trim();
            return cleanedCode.toLowerCase();
        }

        function checkCodeCorrectnessLite(exerciseId, userCode) {
            if (!userCode || typeof userCode !== 'string') return false;
            userCode = mobileNormalize(userCode);
            // Variables 1-5
            if (exerciseId === 1) return userCode.includes('=') && (userCode.includes('"') || userCode.includes("'"));
            if (exerciseId === 2) return userCode.includes('=') && /\d/.test(userCode);
            if (exerciseId === 3) return userCode.includes('=') && (userCode.includes('"') || userCode.includes("'"));
            if (exerciseId === 4) return ((userCode.match(/=/g) || []).length) >= 2;
            if (exerciseId === 5) return ((userCode.match(/=/g) || []).length) >= 3;
            // Numbers 6-10
            if (exerciseId === 6) return userCode.includes('+') && /\d/.test(userCode);
            if (exerciseId === 7) return userCode.includes('-') && /\d/.test(userCode);
            if (exerciseId === 8) return userCode.includes('*') && /\d/.test(userCode);
            if (exerciseId === 9) return userCode.includes('/') && /\d/.test(userCode);
            if (exerciseId === 10) return userCode.includes('=') && /\d/.test(userCode) && (userCode.includes('+') || userCode.includes('-'));
            // Strings 11-15
            if (exerciseId === 11) return userCode.includes('"') || userCode.includes("'");
            if (exerciseId === 12) return (userCode.includes('"') || userCode.includes("'")) && userCode.includes('+');
            if (exerciseId === 13) return userCode.includes('len');
            if (exerciseId === 14) return userCode.includes('upper');
            if (exerciseId === 15) return userCode.includes('=') && (userCode.includes('"') || userCode.includes("'")) && userCode.includes('print');
            // Lists 16-20
            if (exerciseId === 16) return userCode.includes('[');
            if (exerciseId === 17) return userCode.includes('[') && userCode.includes(']');
            if (exerciseId === 18) return userCode.includes('append');
            if (exerciseId === 19) return userCode.includes('len');
            if (exerciseId === 20) return userCode.includes('[') && userCode.includes(':');
            // Loops 21-25
            if (exerciseId === 21) return userCode.includes('for') && userCode.includes('range');
            if (exerciseId === 22) return userCode.includes('for') && userCode.includes(' in ');
            if (exerciseId === 23) return userCode.includes('while');
            if (exerciseId === 24) return userCode.includes('range') && /,/.test(userCode);
            if (exerciseId === 25) return (userCode.match(/for/g) || []).length >= 2;
            // Conditions 26-30
            if (exerciseId === 26) return userCode.includes('if') && userCode.includes('>');
            if (exerciseId === 27) return userCode.includes('if') && userCode.includes('else');
            if (exerciseId === 28) return userCode.includes('elif');
            if (exerciseId === 29) return userCode.includes('if') && userCode.includes(' and ');
            if (exerciseId === 30) return userCode.includes('if') && userCode.includes('>=');
            // Functions 31-35
            if (exerciseId === 31) return userCode.includes('def');
            if (exerciseId === 32) return userCode.includes('def') && /\(/.test(userCode);
            if (exerciseId === 33) return userCode.includes('def') && userCode.includes('return');
            if (exerciseId === 34) return userCode.includes('def') && userCode.includes('=');
            if (exerciseId === 35) return userCode.includes('def') && /=/.test(userCode);
            // Turtle 36-40
            if (exerciseId === 36) return userCode.includes('turtle') && userCode.includes('forward') && userCode.includes('right');
            if (exerciseId === 37) return userCode.includes('turtle') && userCode.includes('circle');
            if (exerciseId === 38) return userCode.includes('turtle') && userCode.includes('color');
            if (exerciseId === 39) return userCode.includes('turtle') && userCode.includes('forward') && userCode.includes('left');
            if (exerciseId === 40) return userCode.includes('turtle') && userCode.includes('forward');
            // Games 41-45
            if (exerciseId === 41) return userCode.includes('input') && userCode.includes('if');
            if (exerciseId === 42) return userCode.includes('random') && userCode.includes('choice');
            if (exerciseId === 43) return userCode.includes('random') && userCode.includes('randint');
            if (exerciseId === 44) return userCode.includes('input') && /\bin\b/.test(userCode);
            if (exerciseId === 45) return userCode.includes('input') && /\d/.test(userCode) && userCode.includes('if');
            // Projects 46-50
            if (exerciseId === 46) return userCode.includes('random') && userCode.includes('choice');
            if (exerciseId === 47) return userCode.includes('print') && (userCode.includes('f"') || userCode.includes("f'") || userCode.includes('format'));
            if (exerciseId === 48) return userCode.includes('random') && userCode.includes('string');
            if (exerciseId === 49) return userCode.includes('enumerate');
            if (exerciseId === 50) return userCode.includes('random') && userCode.includes('randint') && userCode.includes('if');
            return false;
        }

        const testCases = {
            1: ["name='Amy'", 'my_name = "Bob"'],
            2: ['age=7', 'my_age = 10'],
            3: ['color=\n"blue"', "favorite_color='red'"],
            4: ['x=5 x=10', 'a=1 a=2'],
            5: ['n="A" a=1 s="B"', 'name="A"\nage=8\nschool="X"'],
            6: ['5+3', ' 2 + 9 '],
            7: ['10-2', ' 9 - 1 '],
            8: ['4*6', ' 3 * 7 '],
            9: ['20/4', ' 9 / 3 '],
            10: ['a=5 b=3 result=a+b', 'x=10 y=2 z=x-y'],
            11: ['"Hello"', "'Hi'"],
            12: ['"Hello"+"World"', "'A'+'B'"],
            13: ['len("Python")', 'len( "abc" )'],
            14: ['"hello".upper()', 'name.upper()'],
            15: ['g="hi" print(g)', 'msg = "x"\nprint(msg)'],
            16: ['colors=["r","g"]', '[1,2,3]'],
            17: ['fruits=["a","b"]; fruits[0]', '["x"] [0]'],
            18: ['fruits=["a"]; fruits.append("b")', 'x=[];x.append(1)'],
            19: ['len([1,2])', 'x=[1,2,3]; len(x)'],
            20: ['numbers=[1,2,3,4]; numbers[0:2]', '[1,2][0:1]'],
            21: ['for i in range(1,6): print(i)', 'for n in range(5):\n print(n)'],
            22: ['for f in [1,2]: print(f)', 'for x in xs: print(x)'],
            23: ['while x<3: x=x+1', 'count=1 while count<=3: count+=1'],
            24: ['for i in range(2,11,2): print(i)', 'for i in range(1,5,1): print(i)'],
            25: ['for i in range(2): for j in range(2): print(i,j)', 'for a in [1]: for b in [2]: pass'],
            26: ['if 7>5: print(1)', 'x=9 if x>5: print(x)'],
            27: ['if x==1: print(1) else: print(2)', 'if a: print(1) else: print(0)'],
            28: ['if t>30: print(1) elif t>20: print(2) else: print(0)', 'elif x>1'],
            29: ['if 5<=age and age<=10: print(1)', 'if a>1 and b<2: print(1)'],
            30: ['if age>=18: print(1)', 'if x>=0: print(0)'],
            31: ['def f(): pass', 'def say_hello(): print(1)'],
            32: ['def greet(name): print(name)', 'def add(a,b): return a+b'],
            33: ['def add(a,b): return a+b', 'def f(): return 1'],
            34: ['def multiply(x,y): return x*y\nresult = multiply(3,4)', 'def f(a,b): return a*b\nans = f(2,2)'],
            35: ['def greet(name="Friend"): print(name)', 'def f(x=1): return x'],
            36: ['import turtle t=turtle.turtle() for i in range(4): t.forward(1) t.right(90)', 'turtle forward right'],
            37: ['import turtle t=turtle.turtle() t.circle(50)', 'turtle circle'],
            38: ['import turtle t=turtle.turtle() t.color("red")', 'turtle color'],
            39: ['import turtle t=turtle.turtle() t.forward(1) t.left(120)', 'turtle forward left'],
            40: ['import turtle t=turtle.turtle() t.forward(1)', 'turtle forward'],
            41: ['guess = input("?") if guess=="7": print("ok")', 'input if'],
            42: ['import random choices=[1,2] random.choice(choices)', 'random choice'],
            43: ['import random random.randint(1,6)', 'random randint'],
            44: ['word="python" letter = input("") if letter in word: print("ok")', 'input in '],
            45: ['a=5 b=3 answer=int(input("?")) if answer==a+b: print("ok")', 'input 3 if'],
            46: ['import random choices=[1,2] random.choice(choices)', 'random choice'],
            47: ['a=1 b=2 print(f"{a}+{b}={a+b}")', "print('x'.format())"],
            48: ['import random import string password = "".join(random.choices(string.ascii_letters,k=8))', 'random string'],
            49: ['todos=["a"];\nfor i,t in enumerate(todos,1): print(i,t)', 'enumerate(list)'],
            50: ['import random temp=random.randint(0,40) if temp>20: print("warm")', 'randint if']
        };

        function runAllMobileChecks() {
            const resultsDiv = document.getElementById('results');
            const summaryDiv = document.getElementById('summary');
            let total = 0, passed = 0;
            let html = '<table border="1" cellpadding="6" cellspacing="0"><tr><th>ID</th><th>Samples</th><th>Result</th></tr>';
            for (let id = 1; id <= 50; id++) {
                const samples = testCases[id] || [];
                let allPass = true;
                const sampleResults = samples.map(s => {
                    total++;
                    const ok = checkCodeCorrectnessLite(id, s);
                    if (!ok) allPass = false; else passed++;
                    return `${ok ? '‚úÖ' : '‚ùå'} <code>${s.replace(/</g,'&lt;')}</code>`;
                }).join('<br>');
                html += `<tr><td><b>${id}</b></td><td>${sampleResults||'<i>No samples</i>'}</td><td style="font-weight:bold;${allPass?'color:green;':'color:red;'}">${allPass?'PASS':'CHECK'}</td></tr>`;
            }
            html += '</table>';
            resultsDiv.innerHTML = html;
            summaryDiv.textContent = `Passed ${passed} of ${total} sample inputs`;
        }

        document.getElementById('runAll').addEventListener('click', runAllMobileChecks);
    </script>
</body>
</html>
